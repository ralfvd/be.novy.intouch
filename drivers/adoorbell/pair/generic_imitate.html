<script>
var options = {
	template: '../lib/pair/imitate.html',
	id: 'generic_imitate',
	svg: '<?xml version="1.0" encoding="utf-8"?>\n<!-- Generator: Adobe Illustrator 20.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 158.81 270.54" style="enable-background:new 0 0 158.81 270.54;" xml:space="preserve" xmlns:pulse="-">\n<style type="text/css">\n\t.st0{fill-rule:evenodd;clip-rule:evenodd;}\n\t.st1{fill-rule:evenodd;clip-rule:evenodd;fill:#1A1A18;}\n\t.st2{fill:#1A1A18;}\n</style>\n<g>\n\t<circle class="st0" cx="79.41" cy="108.25" r="21.8"/>\n</g>\n<g>\n\t<path d="M79.41,130.76c-12.41,0-22.51-10.1-22.51-22.51s10.1-22.51,22.51-22.51c12.41,0,22.51,10.1,22.51,22.51\n\t\tS91.82,130.76,79.41,130.76z M79.41,87.15c-11.63,0-21.09,9.46-21.09,21.09s9.46,21.09,21.09,21.09s21.09-9.46,21.09-21.09\n\t\tS91.04,87.15,79.41,87.15z"/>\n</g>\n<g>\n\t<circle class="st1" cx="79.41" cy="108.25" r="21.8"/>\n</g>\n<g>\n\t<path d="M79.41,130.76c-12.41,0-22.51-10.1-22.51-22.51s10.1-22.51,22.51-22.51c12.41,0,22.51,10.1,22.51,22.51\n\t\tS91.82,130.76,79.41,130.76z M79.41,87.15c-11.63,0-21.09,9.46-21.09,21.09s9.46,21.09,21.09,21.09s21.09-9.46,21.09-21.09\n\t\tS91.04,87.15,79.41,87.15z"/>\n</g>\n<g>\n\t<circle class="st0" cx="79.41" cy="50.97" r="4.5"/>\n</g>\n<g>\n\t<path d="M79.41,56.18c-2.87,0-5.21-2.34-5.21-5.21s2.34-5.21,5.21-5.21s5.21,2.34,5.21,5.21S82.28,56.18,79.41,56.18z M79.41,47.18\n\t\tc-2.09,0-3.79,1.7-3.79,3.79s1.7,3.79,3.79,3.79c2.09,0,3.79-1.7,3.79-3.79S81.5,47.18,79.41,47.18z"/>\n</g>\n<g>\n\t<path d="M79.41,56.18c-2.87,0-5.21-2.34-5.21-5.21s2.34-5.21,5.21-5.21s5.21,2.34,5.21,5.21S82.28,56.18,79.41,56.18z M79.41,47.18\n\t\tc-2.09,0-3.79,1.7-3.79,3.79s1.7,3.79,3.79,3.79c2.09,0,3.79-1.7,3.79-3.79S81.5,47.18,79.41,47.18z"/>\n</g>\n<g>\n\t<circle pulse:initial="true" pulse:state="1" class="st1" cx="79.41" cy="108.25" r="21.8"/>\n</g>\n<g>\n\t<path d="M79.41,130.76c-12.41,0-22.51-10.1-22.51-22.51s10.1-22.51,22.51-22.51c12.41,0,22.51,10.1,22.51,22.51\n\t\tS91.82,130.76,79.41,130.76z M79.41,87.15c-11.63,0-21.09,9.46-21.09,21.09s9.46,21.09,21.09,21.09s21.09-9.46,21.09-21.09\n\t\tS91.04,87.15,79.41,87.15z"/>\n</g>\n<g>\n\t<path d="M79.41,130.76c-12.41,0-22.51-10.1-22.51-22.51s10.1-22.51,22.51-22.51c12.41,0,22.51,10.1,22.51,22.51\n\t\tS91.82,130.76,79.41,130.76z M79.41,87.15c-11.63,0-21.09,9.46-21.09,21.09s9.46,21.09,21.09,21.09s21.09-9.46,21.09-21.09\n\t\tS91.04,87.15,79.41,87.15z"/>\n</g>\n<g>\n\t<circle class="st0" cx="79.41" cy="50.97" r="4.5"/>\n</g>\n<g>\n\t<path d="M79.41,56.18c-2.87,0-5.21-2.34-5.21-5.21s2.34-5.21,5.21-5.21s5.21,2.34,5.21,5.21S82.28,56.18,79.41,56.18z M79.41,47.18\n\t\tc-2.09,0-3.79,1.7-3.79,3.79s1.7,3.79,3.79,3.79c2.09,0,3.79-1.7,3.79-3.79S81.5,47.18,79.41,47.18z"/>\n</g>\n<g>\n\t<path d="M79.41,56.18c-2.87,0-5.21-2.34-5.21-5.21s2.34-5.21,5.21-5.21s5.21,2.34,5.21,5.21S82.28,56.18,79.41,56.18z M79.41,47.18\n\t\tc-2.09,0-3.79,1.7-3.79,3.79s1.7,3.79,3.79,3.79c2.09,0,3.79-1.7,3.79-3.79S81.5,47.18,79.41,47.18z"/>\n</g>\n<path class="st2" d="M146.91,0H11.9C5.34,0,0,5.34,0,11.9v246.73c0,6.56,5.34,11.9,11.9,11.9h135.01c6.56,0,11.9-5.34,11.9-11.9\n\tV11.9C158.81,5.34,153.47,0,146.91,0z M11.9,2.83h135.01c5,0,9.07,4.07,9.07,9.07v161.92H2.83V11.9C2.83,6.9,6.9,2.83,11.9,2.83z\n\t M146.91,267.7H11.9c-5,0-9.07-4.07-9.07-9.07v-83.4h153.14v83.4C155.98,263.63,151.91,267.7,146.91,267.7z"/>\n</svg>\n',
	body: 'deviceClasses.doorbell.views.generic_imitate.body',
	title: 'views.generic_imitate.title',
	svgWidth: '80vw',
	svgHeight: '70vh',
	initWithDeviceData: false,
	previous: true,
	next: false
};
Homey.setTitle(__(options.title || ''));
Homey.emit('init', options.id);
Homey.on('show_view', function(viewId){
	Homey.showView(viewId);
});
Homey.on('close', function(){
	Homey.close();
});
Homey.on('nextView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) + 1;
	if(viewIndex > 0 && viewIndex < viewsIds.length){
		Homey.showView(viewsIds[viewIndex]);
	}
});
Homey.on('previousView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) - 1;
	if(viewIndex >= 0){
		Homey.showView(viewsIds[viewIndex]);
	}
});
function nextView(){
	if(options.next){
		Homey.nextView();
	}else{
		Homey.emit('next');
	}
}
</script>

<link href="../../../assets/433_generator/css/styles.css" rel="stylesheet" type="text/css"/>

<link href="../../../assets/433_generator/css/svg.css" rel="stylesheet" type="text/css"/>

<script src="../../../assets/433_generator/js/svghighlighter.js" type="text/javascript"></script>

<div class="centered-container">
	<div id="image-container"></div>
	<div id="body"><span class="content"></span></div>
	<div class="foundAnimation" id="foundBackground" style="display:none;"></div>
	<i class="fa fa-check-circle foundAnimation" id="found" style="display:none;" aria-hidden="true"></i>
</div>

<script>
	var idPrefix = '[data-id="' + options.id + '"] ';
	$(idPrefix + '#body > span').html(__(options.body));
	var $imageContainer = $(idPrefix + '#image-container');
	$imageContainer.css('width', options.svgWidth).css('height', options.svgHeight);

	$imageContainer.html(options.svg);
	$imageContainer.highlight();

	var found = false;
	Homey.on('frame', function (data) {
		if(!found) {
			found = true;
			Homey.emit('set_device', data, function (err, device) {
				if (err) {
					if((err.message || err) !== '433_generator.error.invalid_device') {
						Homey.alert(__(err.message || err));
					}
					found = false;
					return;
				}
				const dataKey = JSON.stringify(device.data);
				window.selected_devices = [ dataKey ];
				window.found_devices = {};
				window.found_devices[dataKey] = device;
				var $foundElems = $(idPrefix + '.foundAnimation');
				$foundElems.show();
				setTimeout(function () {
					$foundElems.addClass('fadeOut');
					setTimeout(nextView, 400);
				}, 500);
			});
		}
	});
</script>

<style>
	#found {
		z-index: 2;
		position: absolute;
		top: 20vh;
		left: 38vw;
		font-size: 30vh;
		color: #080;
		opacity: 1;
	}

	#foundBackground {
		z-index: 1;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		position: absolute;
		background-color: #FFF;
		opacity: 0.8;
	}

	.fadeOut {
		-webkit-transition: all 0.5s ease-in-out;
		-moz-transition: all 0.5s ease-in-out;
		-ms-transition: all 0.5s ease-in-out;
		-o-transition: all 0.5s ease-in-out;
		transition: all 0.5s ease-in-out;
		opacity: 0 !important;
	}
</style>